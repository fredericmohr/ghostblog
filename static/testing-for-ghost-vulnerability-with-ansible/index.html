
<head>
    <title>HashtagSecurity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="wot-verification" content="06cd687a47e37736daed"> 
    <link rel="stylesheet" type="text/css" href="../assets/css/mofirst-min.css?v=8ff1f2e80d">
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script> <!-- disqus loader needs latest jquery -->
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="HashtagSecurity">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Testing for GHOST Vulnerability with Ansible">
    <meta property="og:description" content="Yesterday, reports of a critical vulnerability in the GNU C Library (glibc) hit the news. If you have more then just a handful servers to check, this Ansible playbook might be helpful. You can read all about the vulnerability here. Usually when I have to check multiple servers, I use">
    <meta property="og:url" content="fredericmohr.github.io/ghostblog/testing-for-ghost-vulnerability-with-ansible/">
    <meta property="article:published_time" content="2015-01-29T11:52:23.000Z">
    <meta property="article:modified_time" content="2015-02-04T20:29:39.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Testing for GHOST Vulnerability with Ansible">
    <meta name="twitter:description" content="Yesterday, reports of a critical vulnerability in the GNU C Library (glibc) hit the news. If you have more then just a handful servers to check, this Ansible playbook might be helpful. You can read all about the vulnerability here. Usually when I have to check multiple servers, I use">
    <meta name="twitter:url" content="fredericmohr.github.io/ghostblog/testing-for-ghost-vulnerability-with-ansible/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Frederic Mohr">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "HashtagSecurity",
        "logo": {
            "@type": "ImageObject",
            "url": "fredericmohr.github.io/ghostblog/content/images/2014/Oct/tw-logo_400x400-1.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Frederic Mohr",
        "url": "fredericmohr.github.io/ghostblog/author/frederic/",
        "sameAs": []
    },
    "headline": "Testing for GHOST Vulnerability with Ansible",
    "url": "fredericmohr.github.io/ghostblog/testing-for-ghost-vulnerability-with-ansible/",
    "datePublished": "2015-01-29T11:52:23.000Z",
    "dateModified": "2015-02-04T20:29:39.000Z",
    "description": "Yesterday, reports of a critical vulnerability in the GNU C Library (glibc) hit the news. If you have more then just a handful servers to check, this Ansible playbook might be helpful. You can read all about the vulnerability here. Usually when I have to check multiple servers, I use",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "fredericmohr.github.io/ghostblog/"
    }
}
    </script>

    <script src="../public/ghost-sdk.min.js?v=8ff1f2e80d"></script>
<script>
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "5a567477c5aa"
});
</script>
    <meta name="generator" content="Ghost 2.23">
    <link rel="alternate" type="application/rss+xml" title="HashtagSecurity" href="../rss/index.html">
</head>
<body>
<!--NAVIGATION-->
<div class="nav_bar">
	<div class="nav_container">	
		<ul class="nav">
			<li id="nav-index"><a href="../" class="icon-home"></a></li>
			<li id="nav-kalibook"><a href="../getting-started-with-kali-linux/" class="icon-book"></a></li>
			<li id="nav-about"><a href="../about/" class="icon-info"></a></li>
		</ul>

		<!-- Follow Me -->
		<div class="follow_me">
			<a href="https://twitter.com/HashtagSecurity" title="Twitter"><img alt="twitter" src="../assets/images/twi.png?v=8ff1f2e80d"></a>
			<a href="https://www.hashtagsecurity.com/rss" title="RSS"><img alt="rss" src="../assets/images/rss.png?v=8ff1f2e80d"></a>
		</div>
	</div>
</div>
<div class="navline"></div>
<!-- End Header -->
<div class="outer_container">
	<!-- PAGE -->
	<div class="page_container">
		<!-- CONTENT -->
		<div class="post_container">
			    <article class="post">


        <h1 class="post-title">Testing for GHOST Vulnerability with Ansible</h1>
		<span class="post-meta"><a href="http://de.linkedin.com/in/fredericmohr"><b>Frederic Mohr</b></a> - <time datetime="2015-01-29">29 Jan 2015</time> </span>

        <section class="post-content">
            <!--kg-card-begin: markdown--><!--kg-card-begin: markdown--><p><img src="../content/images/2015/01/ghost_vuln_check_ansible.jpg" alt=""><br>
Yesterday, reports of a critical vulnerability in the GNU C Library (glibc) hit the news. If you have more then just a handful servers to check, this Ansible playbook might be helpful.</p>
<p>You can read all about the vulnerability <a href="http://blog.sucuri.net/2015/01/critical-ghost-vulnerability-released.html">here</a>.</p>
<p>Usually when I have to check multiple servers, I use Ansible like this.</p>
<pre><code>ansible 'servergroup' -m shell -a 'command to execute'
</code></pre>
<p>In the case of GHOST, this wasn't working for me as the test command contained both <code>'</code> and <code>"</code> chars. Escaping them didn't seem to work either, so I wrote a small playbook to take care of it.</p>
<pre><code>- hosts: hosts,or,groups,comma,separated
  remote_user: sshuser
  tasks:
    - name: Check if host is vulnerable
      shell: php -r '$e="0";for($i=0;$i&lt;2500;$i++){$e="0$e";} gethostbyname($e);'
      register: ghostvuln
    - debug: var=ghostvuln.stdout_lines
</code></pre>
<p>That's it. If you've never used ansible before, just follow these steps.</p>
<ul>
<li>
<p>install Ansible from your OS repository</p>
</li>
<li>
<p>add hosts to /etc/ansible/hosts</p>
<pre><code>[groupname]
host1
host2
</code></pre>
</li>
<li>
<p>Make sure your SSH key is loaded with <code>ssh-add -L</code></p>
</li>
<li>
<p>Test if Ansible reaches every hosts <br><br>
<code>ansible 'group,or,hosts' -m shell -a 'hostname -f'</code></p>
</li>
<li>
<p>Execute Ansible playbook <br><br>
<code>ansible-playbook /path/to/playbook</code></p>
</li>
</ul>
<p>If you get either one of these, everything is fine.<br>
<img src="../content/images/2015/01/ghostvuln.png" alt=""><br>
<img src="../content/images/2015/01/del1-4.png" alt=""></p>
<p><code>changed</code> just means that the command could be executed, check further down for the result. As you can see in the second image, the command did not return <code>Segmentation Fault</code><br>
<code>failed</code> means, that the could not be executed, in this case because php isn't installed.</p>
<p>This is ans example of a vulnerable host returning a segfault message.<br>
<img src="../content/images/2015/01/del1-5.png" alt=""></p>
<p><strong>Note:</strong> The check command above uses PHP, which I don't have installed on all my servers. Since this is a glibc vulnerability, I'm pretty sure that hosts can be vulnerable even if PHP is not installed. I will update this post if I find a way to check servers without PHP. Until then, install php5-cli if you don't have php on the system.</p>
<p><strong>Update 1:</strong> More info on this bug can be found <a href="http://www.cyberciti.biz/faq/cve-2015-0235-patch-ghost-on-debian-ubuntu-fedora-centos-rhel-linux/">here</a>, including how to get a list of services that use glibc (Debian/Ubuntu)</p>
<pre><code>sudo lsof | grep libc | awk '{print $1}' | sort | uniq
</code></pre>
<p>Also, make sure to reboot the servers after you've installed the patches or the server will remain vulnerable!</p>
<p><strong>Update 2:</strong> An easier way to check if your server is vulnerable, is to check for the glibc version by running the following command.</p>
<pre><code>$ ldd --version
ldd (Ubuntu EGLIBC 2.19-0ubuntu6.4) 2.19
Copyright (C) 2014 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
Written by Roland McGrath and Ulrich Drepper.

$ ansible 'servergroup' -m shell -a 'ldd --version |grep "^ldd"'
</code></pre>
<p>According to Tomas Hoger, the issues was fixed in glibc 2.18.</p>
<p><img src="../content/images/2015/01/del1-6.png" alt=""><br>
<small>source: <a href="https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2015-0235">bugzilla.redhat.com</a></small></p>
<!--kg-card-end: markdown--><!--kg-card-end: markdown-->
	
        </section>

<br>
<hr>
<br>
	<!-- START DISQUS IMPLEMENTATION -->
        <script src="/assets/js/disqus.js?v=8ff1f2e80d&gt;&lt;/script&gt;%0A%20%20%20%20%20%20%20%20&lt;div%20id=" disqus_thread></script></article></div>
        <!--<div class="post_disqus show-comments" title="Privacy: Click to enable Disqus (uses cookies!)"><b>Enable Disqus</b></div>
	END DISQUS IMPLEMENTATION -->



		</div>

		<!-- SIDEBAR -->
		<div class="side_container">

			<div class="side_sub_one well">
				<b>Note</b>
				<div class="side_sub_hl_blue"></div>
				<p>All information provided on this site is for educational purposes only. The site and it's author is in no way responsible for any misuse of the information.</p>
			</div>
			<div class="side_sub_one well">
				<b>Links</b>
				<div class="side_sub_hl_blue"></div>
				<p>
				<a href="../random-notes/">Random Notes and CheatSheets</a><br>
				</p><hr>
				<a href="http://learnpythonthehardway.org/book/">Python the hard way</a><br>
				<a href="http://cspplayground.com">CSP Playground</a><br>
				<a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page">Metasploit Unleashed</a><br>
				<hr>
				<a href="https://www.linkedin.com/profile/view?id=203397467">Me - LinkedIn</a><br>
				<a href="https://ctftime.org/team/9072">Me - CTFTime.org</a><br>
				
			</div>		
			<div class="side_sub_one well">
				<b>Blogs</b>
				<div class="side_sub_hl_blue"></div>
				<p>
				<a href="http://wearetheartillery.blogspot.com.es/">WeAreTheArtillery</a><br>
				<a href="https://www.imperialviolet.org">Imperial Violet</a><br>
				<a href="http://www.nerd-supreme.de">NerdSupreme (DE)</a><br>
				<a href="http://krebsonsecurity.com/">KrebsOnSecurity</a><br>
				<a href="https://www.corelan.be/">Corelan Team</a><br>
				<a href="http://blog.g0tmi1k.com/">G0tmi1k</a><br>
				</p>
			</div>		
			<div class="side_sub_one well">
				<b>Reddits</b>
				<div class="side_sub_hl_blue"></div>
				<p>
				<a href="http://www.reddit.com/r/netsec/">/r/netsec</a><br>
				<a href="http://www.reddit.com/r/Python/">/r/Python</a><br>
				<a href="http://www.reddit.com/r/Defcon/">/r/Defcon</a><br>
				<a href="http://www.reddit.com/r/securityCTF/">/r/securityCTF</a><br>
				<a href="index.html"></a><br>
				</p>
			</div>		
		</div>
	</div> <!-- End of Sidebar -->

	<div class="footer">
	<div class="navline"></div>
		HashtagSecurity<br><small>... keeping security in mind.<br><a href="../impressum">Impressum</a> | <a href="../datenschutzerklarung">Datenschutzerklärung</a> | <a href="../privacy-policy">Privacy Policy</a></small>
	</div>
</body>
